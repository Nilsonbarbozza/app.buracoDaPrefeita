<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>👩‍💻home</title>
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
</html>

<body>
	<header>
		<nav class="bg-gray-900 border-gray-200 dark:bg-gray-900">
			<div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl p-4">
				<a href="https://flowbite.com" class="flex items-center space-x-3 rtl:space-x-reverse">
					<img src="https://flowbite.com/docs/images/logo.svg" class="h-8" alt="Flowbite Logo" />
					<span class="self-center text-2xl font-semibold whitespace-nowrap dark:text-white">Flowbite</span>
				</a>
				<div class="flex items-center space-x-3 rtl:space-x-reverse">
					<a href="tel:5541251234" class="text-sm  text-white dark:text-white hover:underline">Contato</a>
					<a href="{% url 'enviar_denuncia' %}" class="font-bold text-white dark:text-bg-white hover:underline">Denunciar</a>
				</div>
			</div>
		</nav>
	</header>

    <!-- component -->
<main class="py-6 px-6 flex flex-col gap-6 bg-gray-100 min-h-screen w-full">
	<!-- CONTENT GOES HERE -->
	<div class="flex flex-col mx-auto max-w-screen-xl p-4 space-y-6">
		<section class="flex flex-col bg-white rounded-lg p-6 shadow-md space-y-6">
			<div class="w-full grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6">
				<div class="col-span-1 flex items-center">
					<button class="relative px-4 py-2 rounded w-80 items-center justify-center bg-gray-900 text-gray-300 font-medium hover:bg-primary-900">
						Buracomêtro
					</button>
				</div>
				<form method="GET" action="" class="flex flex-col relative md:flex-row md:items-center w-full max-w-md">
					<div class="relative w-full">
					  <select name="cidade" id="cidade" class="block w-full p-4 ps-10 text-sm text-gray-900 border border-gray-100 rounded bg-gray-100 focus:ring-blue-500 focus:border-blue-500 appearance-none">
						<option value="">Selecione sua cidade</option>
						{% for cidade in cidades %}
						  <option value="{{ cidade.nome }}">{{ cidade.nome }}</option>
						{% endfor %}
					  </select>
					  <div class="absolute inset-y-0 left-0 flex items-center ps-3 pointer-events-none">
						<svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="#5f6368">
						  <path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/>
						</svg>
					  </div>
					</div>
					<button type="submit" class="mt-2 md:mt-0 md:ml-2 text-blue-500 border border-blue-500 hover:bg-blue-50 font-medium rounded text-base px-4 py-2">
					  Buscar
					</button>
				  </form>
			</div>


			<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 w-full min-w-0">
				<!-- In use -->
				
				<div class="flex flex-col px-6 py-2 bg-red-600 shadow rounded-lg overflow-hidden">
					<div class="flex flex-col items-center space-y-2">
						<div class="text-6xl font-bold tracking-tight leading-none text-white">10</div>
						<div class="text-lg font-bold text-white">Denuncias</div>
					</div>
				</div>
				<!-- renovation -->
				<div class="flex flex-col px-6 py-2 bg-green-700 shadow rounded-lg overflow-hidden">
					<div class="flex flex-col items-center space-y-2">
						<div class="text-6xl font-bold tracking-tight leading-none text-white">17</div>
						<div class="text-lg font-bold text-white">Resolvido</div>
					</div>
				</div>
			</div>
		</section>

		<!--card-->
		<div class="flex flex-wrap justify-center gap-6">
		{% for denuncia in denuncias %}
			<div class="relative flex w-full max-w-[22rem] h-full flex-col rounded-xl bg-white bg-clip-border text-gray-700 shadow-lg">
				<div class="relative mx-4 mt-4 overflow-hidden rounded-xl bg-blue-gray-500 bg-clip-border text-white shadow-lg shadow-blue-gray-500/40">
				<img class="max-h-[23rem] w-full"
					src="{{ denuncia.foto.url }}"
					alt="Patho-denuncia"
				/>
				<div class="to-bg-black absolute inset-0 h-full w-full bg-gradient-to-tr from-transparent via-transparent to-red/60"></div>
				<button
					class="flex flex-row items-center justify-center gap-1 absolute px-2 top-4 right-4 h-8 max-h-[64px] w-14 max-w-[64px] select-none rounded-lg text-center font-sans font-bold uppercase bg-red-600"
					type="button"
				> {{ denuncia.denuncias_detalhadas.count }}
					<span>
						<svg
						xmlns="http://www.w3.org/2000/svg"
						viewBox="0 0 24 24"
						fill="currentColor"
						aria-hidden="true"
						class="h-6 w-6 text-white"
					>
						<path
						fill-rule="evenodd"
						d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm-2.625 6c-.54 0-.828.419-.936.634a1.96 1.96 0 0 0-.189.866c0 .298.059.605.189.866.108.215.395.634.936.634.54 0 .828-.419.936-.634.13-.26.189-.568.189-.866 0-.298-.059-.605-.189-.866-.108-.215-.395-.634-.936-.634Zm4.314.634c.108-.215.395-.634.936-.634.54 0 .828.419.936.634.13.26.189.568.189.866 0 .298-.059.605-.189.866-.108.215-.395.634-.936.634-.54 0-.828-.419-.936-.634a1.96 1.96 0 0 1-.189-.866c0-.298.059-.605.189-.866Zm-4.34 7.964a.75.75 0 0 1-1.061-1.06 5.236 5.236 0 0 1 3.73-1.538 5.236 5.236 0 0 1 3.695 1.538.75.75 0 1 1-1.061 1.06 3.736 3.736 0 0 0-2.639-1.098 3.736 3.736 0 0 0-2.664 1.098Z"
						clip-rule="evenodd"
						></path>
						</svg>
					</span>
				</button>
				</div>
				<!--Info-denunciante-->
				<div class="flex flex-col mx-6 my-2">
				<div class="mb-1 flex flex-row items-center gap-1.5">
					<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="mt-0.5 h-6 w-6 text-blue-gray-900">
						<path fillRule="evenodd" d="M18.685 19.097A9.723 9.723 0 0 0 21.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 0 0 3.065 7.097A9.716 9.716 0 0 0 12 21.75a9.716 9.716 0 0 0 6.685-2.653Zm-12.54-1.285A7.486 7.486 0 0 1 12 15a7.486 7.486 0 0 1 5.855 2.812A8.224 8.224 0 0 1 12 20.25a8.224 8.224 0 0 1-5.855-2.438ZM15.75 9a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" clipRule="evenodd" />
					</svg>					  
					<h4 class="block font-sans text-xl font-bold leading-snug tracking-normal text-blue-gray-900 antialiased">
						{{ denuncia.nome_visivel }}
					</h4>
				</div>
				<p class="flex items-center mb-1 gap-1.5 font-sans font-medium text-blue-gray-900 ">
					<svg
						xmlns="http://www.w3.org/2000/svg"
						viewBox="0 0 24 24"
						fill="currentColor"
						class="mt-0.5 h-6 w-6 text-blue-gray-900"
					>
						<path
						fill-rule="evenodd"
						d="m11.54 22.351.07.04.028.016a.76.76 0 0 0 .723 0l.028-.015.071-.041a16.975 16.975 0 0 0 1.144-.742 19.58 19.58 0 0 0 2.683-2.282c1.944-1.99 3.963-4.98 3.963-8.827a8.25 8.25 0 0 0-16.5 0c0 3.846 2.02 6.837 3.963 8.827a19.58 19.58 0 0 0 2.682 2.282 16.975 16.975 0 0 0 1.145.742ZM12 13.5a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"
						clip-rule="evenodd"
						></path>
					</svg>
					{{ denuncia.endereco }}, {{ denuncia.cidade.nome }} - {{ denuncia.cidade.estado }}
					</p>
				<p class="flex items-center gap-1.5 font-sans font-medium text-blue-gray-900 ">
					<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="mt-0.5 h-6 w-6 text-blue-gray-900">
						<path d="M12.75 12.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM7.5 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM8.25 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM9.75 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM10.5 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM12.75 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM14.25 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM15 17.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM16.5 15.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5ZM15 12.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM16.5 13.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" />
						<path fillRule="evenodd" d="M6.75 2.25A.75.75 0 0 1 7.5 3v1.5h9V3A.75.75 0 0 1 18 3v1.5h.75a3 3 0 0 1 3 3v11.25a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3V7.5a3 3 0 0 1 3-3H6V3a.75.75 0 0 1 .75-.75Zm13.5 9a1.5 1.5 0 0 0-1.5-1.5H5.25a1.5 1.5 0 0 0-1.5 1.5v7.5a1.5 1.5 0 0 0 1.5 1.5h13.5a1.5 1.5 0 0 0 1.5-1.5v-7.5Z" clipRule="evenodd" />
					</svg>
					
					</svg>
					{{ denuncia.data_registro|date:"d/m/Y H:i" }}
					</p>
		
				<!--Indicador Situação-->
				<div class="flex flex-row items-center justify-between group mt-4 inline-flex flex-wrap">
					<p class="flex items-center font-sans font-light text-blue-gray-900 ">Situação:</p>
					{% if denuncia.situacao == 'NAO_RESOLVIDO' %}
					<span
					data-tooltip-target="Não Resolvido"
					class=" flex flex-row items-center gap-2 rounded-full border border-red-500/5 bg-red-500/5 p-3 text-red-500 transition-colors hover:border-red-500/10 hover:bg-red-500/10 hover:!opacity-100 group-hover:opacity-70"
					>
					<svg
						xmlns="http://www.w3.org/2000/svg"
						viewBox="0 0 24 24"
						fill="currentColor"
						aria-hidden="true"
						class="h-8 w-8 text-red-500"
					>
						<path
						fill-rule="evenodd"
						d="M15.73 5.5h1.035A7.465 7.465 0 0 1 18 9.625a7.465 7.465 0 0 1-1.235 4.125h-.148c-.806 0-1.534.446-2.031 1.08a9.04 9.04 0 0 1-2.861 2.4c-.723.384-1.35.956-1.653 1.715a4.499 4.499 0 0 0-.322 1.672v.633A.75.75 0 0 1 9 22a2.25 2.25 0 0 1-2.25-2.25c0-1.152.26-2.243.723-3.218.266-.558-.107-1.282-.725-1.282H3.622c-1.026 0-1.945-.694-2.054-1.715A12.137 12.137 0 0 1 1.5 12.25c0-2.848.992-5.464 2.649-7.521C4.537 4.247 5.136 4 5.754 4H9.77a4.5 4.5 0 0 1 1.423.23l3.114 1.04a4.5 4.5 0 0 0 1.423.23ZM21.669 14.023c.536-1.362.831-2.845.831-4.398 0-1.22-.182-2.398-.52-3.507-.26-.85-1.084-1.368-1.973-1.368H19.1c-.445 0-.72.498-.523.898.591 1.2.924 2.55.924 3.977a8.958 8.958 0 0 1-1.302 4.666c-.245.403.028.959.5.959h1.053c.832 0 1.612-.453 1.918-1.227Z"
						clip-rule="evenodd"
						></path>
					</svg>
						<p class="flex items-center gap-1.5 font-sans font-bold text-red-500 ">NÃO RESOLVIDO!</p>
					</span>
					{% else %}
					<!--if resolvido-->
					<span
					data-tooltip-target="Resolvido"
					class=" flex flex-row items-center gap-2 rounded-full border border-green-500/5 bg-green-500/5 p-3 text-green-500 transition-colors hover:border-greennk-500/10 hover:bg-green-500/10 hover:!opacity-100 group-hover:opacity-70"
					>
					<svg
						xmlns="http://www.w3.org/2000/svg"
						viewBox="0 0 24 24"
						fill="currentColor"
						aria-hidden="true"
						class="h-8 w-8 text-green-500"
					>
						<path
						fill-rule="evenodd"
						d="M7.493 18.5c-.425 0-.82-.236-.975-.632A7.48 7.48 0 0 1 6 15.125c0-1.75.599-3.358 1.602-4.634.151-.192.373-.309.6-.397.473-.183.89-.514 1.212-.924a9.042 9.042 0 0 1 2.861-2.4c.723-.384 1.35-.956 1.653-1.715a4.498 4.498 0 0 0 .322-1.672V2.75A.75.75 0 0 1 15 2a2.25 2.25 0 0 1 2.25 2.25c0 1.152-.26 2.243-.723 3.218-.266.558.107 1.282.725 1.282h3.126c1.026 0 1.945.694 2.054 1.715.045.422.068.85.068 1.285a11.95 11.95 0 0 1-2.649 7.521c-.388.482-.987.729-1.605.729H14.23c-.483 0-.964-.078-1.423-.23l-3.114-1.04a4.501 4.501 0 0 0-1.423-.23h-.777ZM2.331 10.727a11.969 11.969 0 0 0-.831 4.398 12 12 0 0 0 .52 3.507C2.28 19.482 3.105 20 3.994 20H4.9c.445 0 .72-.498.523-.898a8.963 8.963 0 0 1-.924-3.977c0-1.708.476-3.305 1.302-4.666.245-.403-.028-.959-.5-.959H4.25c-.832 0-1.612.453-1.918 1.227Z"
						clip-rule="evenodd"
						></path>
					</svg>
						<p class="flex items-center gap-1.5 font-sans font-bold text-green-500 ">RESOLVIDO!</p>
					</span>
					{% endif %}
		
		
					
				</div>
				</div>
				<div class="flex flex-row gap-2 justify-between py-4 p-4 pt-3">
				<button
					class="flex flex-row items-center sm:items center cursor-pointer gap-1 select-none rounded-lg bg-gray-100 p-3 text-center align-middle font-sans text-sm font-bold uppercase text-gray-900 shadow-md shadow-pink-500/20 transition-all hover:shadow-lg hover:shadow-pink-500/40 focus:opacity-[0.85] focus:shadow-none active:opacity-[0.85] active:shadow-none disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none"
					type="submit"	
				>
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-8 w-8 text-black">
					<path fillRule="evenodd" d="M15.75 4.5a3 3 0 1 1 .825 2.066l-8.421 4.679a3.002 3.002 0 0 1 0 1.51l8.421 4.679a3 3 0 1 1-.729 1.31l-8.421-4.678a3 3 0 1 1 0-4.132l8.421-4.679a3 3 0 0 1-.096-.755Z" clipRule="evenodd" />
				</svg>				  
				Compartilhar
				</button>
					
				<button
					class=" flex flex-row items-center cursor-pointer gap-2 w-full select-none rounded-lg bg-red-600 p-3 text-center align-middle font-sans text-sm font-bold uppercase text-white shadow-md shadow-pink-500/20 transition-all hover:shadow-lg hover:shadow-pink-500/40 focus:opacity-[0.85] focus:shadow-none active:opacity-[0.85] active:shadow-none disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none"
					type="botton"
					data-ripple-light="true"
					onclick="abrirModal({{ denuncia.id }})"
					>
					<svg
					xmlns="http://www.w3.org/2000/svg"
					viewBox="0 0 24 24"
					fill="currentColor"
					aria-hidden="true"
					class="h-8 w-8 text-white"
				>
					<path
					fill-rule="evenodd"
					d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm-2.625 6c-.54 0-.828.419-.936.634a1.96 1.96 0 0 0-.189.866c0 .298.059.605.189.866.108.215.395.634.936.634.54 0 .828-.419.936-.634.13-.26.189-.568.189-.866 0-.298-.059-.605-.189-.866-.108-.215-.395-.634-.936-.634Zm4.314.634c.108-.215.395-.634.936-.634.54 0 .828.419.936.634.13.26.189.568.189.866 0 .298-.059.605-.189.866-.108.215-.395.634-.936.634-.54 0-.828-.419-.936-.634a1.96 1.96 0 0 1-.189-.866c0-.298.059-.605.189-.866Zm-4.34 7.964a.75.75 0 0 1-1.061-1.06 5.236 5.236 0 0 1 3.73-1.538 5.236 5.236 0 0 1 3.695 1.538.75.75 0 1 1-1.061 1.06 3.736 3.736 0 0 0-2.639-1.098 3.736 3.736 0 0 0-2.664 1.098Z"
					clip-rule="evenodd"
					></path>
					</svg>
					Denunciar
				</button>
				
				<div id="modal-denuncia" class="fixed inset-0 z-50 p-4 hidden flex items-center justify-center  shadow-black-500/20 backdrop-blur-sm bg-black/30">
					<div class="relative w-full max-w-md bg-gray-100 backdrop-blur-md shadow-xl rounded-2xl border border-white/20 p-6">
					  
					  <!-- Botão de fechar -->
					  <button onclick="fecharModal()" class="absolute bg-red-700 top-2 px-2 right-2 rounded-lg text-white font-bold text-lg hover:scale-110 transition-transform">
						✕
					  </button>
				  
					  <!-- Formulário -->
					  <form id="form-denuncia">
						{% csrf_token %}
						<input type="hidden" name="denuncia_id" id="denuncia_id">
						
						<h2 class="text-gray-900 text-xl font-semibold mb-4 text-center">Reportar sua Denúncia</h2>
						
						<div class="mb-3">
						  <input type="text" name="nome" placeholder="Digitar nome" required
								 class="w-full p-2 rounded-lg bg-white text-black placeholder-gray-600 focus:outline-none focus:ring-2 focus:ring-green-500">
						</div>
				  
						<div class="mb-3">
						  <input type="email" name="email" placeholder="Digitar E-mail" required
								 class="w-full p-2 rounded-lg bg-white text-black placeholder-gray-600 focus:outline-none focus:ring-2 focus:ring-green-500">
						</div>
				  
						<div class="mb-4">
						  <input type="text" name="telefone" id="telefone" placeholder="(xx) xxxxx-xxxx" required
								 class="w-full p-2 rounded-lg bg-white text-black placeholder-gray-600 focus:outline-none focus:ring-2 focus:ring-green-500">
						</div>
				  
						<button type="submit"
								class="w-full cursor-pointer bg-green-700 hover:bg-green-700 text-white font-semibold py-2 rounded-lg transition duration-200">
						  Enviar
						</button>
						<p class="text-xs py-4 text-gray-900 text-center mb-4">
							🔒 Seus dados estão protegidos. Esta denúncia é <strong>anônima</strong> e garantida pela Lei do Marco Civil da Internet.
						</p>
					  </form>
					</div>
				  </div>
				  
			</div>
		{% endfor %}
		</div>	
	</div>

</main>

	<!-- CONTENT GOES HERE 2 -->
	<div class="flex flex-col sm:flex-row mx-auto max-w-screen-xl p-4 space-y-6">
		<!-- component -->
			<div class="w-full pt-5 px-4 mb-8 mx-auto ">
				<div class="text-sm text-gray-700 py-1">
					Made with <a class="text-gray-700 font-semibold" href="https://www.material-tailwind.com/docs/html/card?ref=tailwindcomponents" target="_blank">Material Tailwind</a> by <a href="https://www.creative-tim.com?ref=tailwindcomponents" class="text-gray-700 font-semibold" target="_blank"> Creative Tim</a>.
				</div>
			</div>
	</div>
	

	<script>
		function abrirModal(denunciaId) {
		  document.getElementById('modal-denuncia').classList.remove('hidden');
		  document.getElementById('denuncia_id').value = denunciaId;
		}
		
		function fecharModal() {
		  document.getElementById('modal-denuncia').classList.add('hidden');
		}
		
		// Intercepta o submit do formulário do modal
		document.addEventListener('DOMContentLoaded', function () {
		  const form = document.getElementById('form-denuncia');
		
		  form.addEventListener('submit', function (e) {
			e.preventDefault(); // impede o envio tradicional do form
		
			const formData = new FormData(form);
			const denunciaId = formData.get('denuncia_id');
		
			fetch(`/denunciar_modal/${denunciaId}/`, {
			  method: 'POST',
			  headers: {
				'X-CSRFToken': formData.get('csrfmiddlewaretoken')
			  },
			  body: formData
			})
			.then(response => response.json())
			.then(data => {
			  if (data.success) {
				fecharModal();
				location.reload(); // recarrega página para atualizar contagem
			  } else {
				console.error('Erro ao enviar:', data.errors);
				alert('Erro ao enviar a denúncia. Verifique os campos.');
			  }
			})
			.catch(error => {
			  console.error('Erro na requisição:', error);
			  alert('Erro inesperado ao enviar a denúncia.');
			});
		  });
		});
		</script>

		<script>
			document.addEventListener("DOMContentLoaded", function () {
			  const telefoneInput = document.getElementById('telefone');
			
			  telefoneInput.addEventListener('input', function (e) {
				let value = e.target.value.replace(/\D/g, '');
			
				if (value.length > 11) value = value.slice(0, 11);
			
				let formatted = '';
				if (value.length > 0) {
				  formatted += '(' + value.substring(0, 2);
				}
				if (value.length >= 3) {
				  formatted += ') ' + value.substring(2, 7);
				}
				if (value.length >= 8) {
				  formatted += '-' + value.substring(7, 11);
				}
			
				e.target.value = formatted;
			  });
			
			  // Evita que o usuário digite letras
			  telefoneInput.addEventListener('keypress', function (e) {
				if (!/\d/.test(e.key)) {
				  e.preventDefault();
				}
			  });
			
			  // Corrige problemas ao apagar
			  telefoneInput.addEventListener('keydown', function (e) {
				const key = e.key;
				if (key === 'Backspace') {
				  const val = e.target.value;
				  if (val.endsWith('-') || val.endsWith(') ') || val.endsWith('(')) {
					e.target.value = val.slice(0, -1);
				  }
				}
			  });
			});
			</script>
			
		
		
  
</bory>